# Network of Coffee API

API для сети кофеен с использованием FastAPI.

## Требования

- Python 3.8+
- PostgreSQL
- pip

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/network-of-coffee-api.git
cd network-of-coffee-api
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл .env в корневой директории проекта:
```env
DATABASE_URL=postgresql://postgres:root@localhost:5432/network-of-coffee-db
SECRET_KEY=your-secret-key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

5. Примените миграции:
```bash
alembic upgrade head
```

## Запуск

1. Запустите сервер разработки:
```bash
uvicorn src.main:app --reload
```

2. Откройте браузер и перейдите по адресу:
```
http://127.0.0.1:8000/api
```

## Тестирование

Для запуска тестов выполните:
```bash
pytest
```

## API Endpoints

- POST /api/register - Регистрация пользователя
- POST /api/token - Получение токена авторизации
- GET /api/me - Информация о текущем пользователе
- GET /api/users - Список пользователей (только для админов)
- GET /api/products - Список продуктов
- GET /api/categories - Список категорий
- GET /api/orders - Список заказов
- GET /api/cart - Корзина
- GET /api/chat - Чат
- GET /api/static - Статические файлы

---

## Описание проекта

Проект разработан согласно тестовому заданию и включает следующие основные компоненты:

- **Управление пользователями:** регистрация, аутентификация, верификация, получение и редактирование данных, а также автоматическая очистка не верифицированных пользователей.
- **Управление заказами:** создание, изменение, удаление и получение данных о заказах.
- **Управление меню:** создание и редактирование категорий и товаров, а также организация связей между ними.
- **Управление корзиной:** добавление и удаление товаров из корзины.
- **Чат поддержки:** реализация поддержки через WebSocket.
- **Фильтры и пагинация:** для GET-запросов реализованы сортировка, фильтрация по любым полям и поиск.
- **Статичная информация:** маршрут для получения данных о расположении, графике работы и прочем.
- **Безопасность:** базовая защита от CSRF, XSS и SQL-инъекций.
- **Документация и контейнеризация:** интеграция Swagger для тестирования API и Docker для упрощения развёртывания.

---

## Технологии и библиотеки

- **FastAPI:** основной фреймворк для создания API.
- **SQL (PostgreSQL/SQLite/MySQL):** реляционная база данных.
- **ORM:** выбранный для удобства работы с базой (например, SQLAlchemy или Tortoise ORM).
- **JWT:** для управления авторизацией и идентификацией пользователей.
- **Docker:** для контейнеризации приложения.
- **Swagger:** для автоматической генерации документации API.
- **WebSocket:** для реализации чата поддержки.

---

## Структура проекта


---

## Модели и их связи

### Пользователь (User)
- **Поля:** `id`, `username`, `email`, `password`, `role`, `is_verified`, `created_at` и т.д.
- **Функционал:** регистрация, аутентификация, верификация, автоматическая очистка не верифицированных записей.

### Категория (Category)
- **Поля:** `id`, `name`, `description`.
- **Связь:** каждая категория может содержать несколько товаров.

### Товар (Product)
- **Поля:** `id`, `name`, `description`, `price`, `category_id`.
- **Связь:** принадлежит определённой категории.

### Заказ (Order)
- **Поля:** `id`, `user_id`, `total_price`, `status`, `created_at`.
- **Связь:** связывает заказ с пользователем и включает данные о заказанных товарах.

### Корзина (Cart)
- **Поля:** `id`, `user_id`.
- **Связь:** содержит товары, добавленные пользователем; может реализовываться через отдельную промежуточную таблицу для хранения количества и выбранных товаров.

---

## API эндпоинты

### Пользователи (Users-management)
- `POST /registration` – регистрация нового пользователя
- `POST /authentication` – аутентификация и получение JWT
- `POST /verification` – верификация пользователя
- `GET /users` – получение списка всех пользователей
- `GET /user/:id` – получение информации о конкретном пользователе
- `PUT /user/:id`, `PATCH /user/:id` – редактирование данных пользователя
- `DELETE /user/:id` – удаление пользователя

### Категории (Categories-management)
- `POST /category` – создание новой категории
- `GET /categories` – получение списка категорий
- `GET /category/:id` – получение данных о конкретной категории
- `PUT /category/:id`, `PATCH /category/:id` – редактирование категории
- `DELETE /category/:id` – удаление категории

### Товары (Product-management)
- `POST /product` – создание нового товара
- `GET /products` – получение списка товаров
- `GET /product/:id` – получение данных о конкретном товаре
- `PUT /product/:id`, `PATCH /product/:id` – редактирование товара
- `DELETE /product/:id` – удаление товара

### Заказы (Order-management)
- `POST /order` – создание нового заказа
- `GET /orders` – получение списка заказов
- `GET /order/:id` – получение данных о конкретном заказе
- `PUT /order/:id`, `PATCH /order/:id` – редактирование заказа
- `DELETE /order/:id` – удаление заказа

### Корзина (Cart)
- `POST /cart` – добавление товара в корзину
- `DELETE /cart/:id` – удаление отдельного товара из корзины
- `DELETE /cart/` – очистка корзины

### JWT
- `POST /access` – получение access токена
- `POST /refresh` – обновление токена

### Дополнительные маршруты
- **Чат поддержки:** маршруты для работы с WebSocket.
- **Статичная информация:** маршрут для получения данных о расположении, графике работы и т.д.
- **Фильтры:** универсальные GET-маршруты с поддержкой сортировки, фильтрации по любым полям, поиска и пагинации.

---

## Установка и запуск

1. **Клонирование репозитория:**

   ```bash
   git clone https://github.com/your-username/coffee-backend.git
   cd coffee-backend
